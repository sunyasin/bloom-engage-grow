TODO Univer

Теперь я вижу логику проверки доступа в `CoursesTab.tsx`. Мне нужно проверить, как эта проверка работает на странице `CoursePreview.tsx` - там должна быть аналогичная проверка при входе в курс.

Теперь понятно! В `CoursePreview.tsx` **отсутствует проверка доступа к курсу** на основе настроек доступа (`access_types`). Логика проверки есть только в `CoursesTab.tsx` (на уровне отображения карточек), но когда пользователь переходит напрямую на страницу курса, проверка не выполняется.

Давайте проверю, как именно происходит навигация на курс:

Теперь картина ясна. Проблема следующая:

1. **В `CoursesTab.tsx`** - есть проверка доступа `hasAccessToCourse()`, которая блокирует клик на карточку курса если пользователь не имеет доступа.

2. **В `CoursePreview.tsx`** - **НЕТ никакой проверки доступа**. Курс просто загружается и отображается, даже если пользователь напрямую перешел по URL `/course/{id}/preview`.

Это означает, что пользователь может обойти проверку доступа, просто введя прямой URL курса в браузере.

Мне нужно посмотреть, какие данные о курсе и подписках нужно получить для проверки:

Теперь у меня есть полная картина проблемы. Давайте также проверю, какие данные о подписках нужны:

Теперь я вижу полную картину. У курсов есть `access_types` с типами доступа, а подписки имеют `features` (например, `courses_selected`) и `selected_course_ids` - список курсов, к которым дает доступ подписка.

Проблема ясна:
1. Курс имеет настройки доступа (`access_types`)
2. Подписки определяют, какие курсы доступны (`selected_course_ids`)
3. Но на странице `CoursePreview.tsx` проверка доступа **не выполняется** - пользователь может войти по прямой ссылке

## План: Добавление проверки доступа к курсу на странице CoursePreview

### Проблема
Сейчас проверка доступа к курсу реализована только в `CoursesTab.tsx` на уровне отображения карточек. Если пользователь знает прямой URL курса (`/course/{id}/preview`), он может обойти проверку и получить доступ к контенту.

### Решение
Добавить полноценную проверку доступа в `CoursePreview.tsx`, которая будет:
1. Загружать расширенные данные курса (`access_types`, `required_rating`, `delay_days`, `promo_code`, `gifted_emails`)
2. Загружать данные подписки пользователя и тарифы сообщества
3. Проверять доступ по всем условиям (аналогично логике в `CoursesTab.tsx`)
4. Показывать страницу "Доступ запрещен" с информацией о способах получения доступа

### Изменения

#### 1. Расширить интерфейс Course в CoursePreview.tsx
Добавить поля для проверки доступа:
```typescript
interface Course {
  // существующие поля...
  access_type: AccessType | null;
  access_types: string[] | null;
  required_rating: number | null;
  delay_days: number | null;
  promo_code: string | null;
  gifted_emails: string | null;
}
```

#### 2. Добавить состояния для данных доступа
```typescript
const [userMembership, setUserMembership] = useState(null);
const [userTier, setUserTier] = useState(null);
const [userProfile, setUserProfile] = useState(null);
const [allTiers, setAllTiers] = useState([]);
const [hasAccess, setHasAccess] = useState(null);
const [accessDeniedReason, setAccessDeniedReason] = useState(null);
```

#### 3. Перенести логику проверки доступа из CoursesTab
Вынести функции в отдельный хук или утилиту `src/lib/courseAccess.ts`:
- `getAccessTypes(course)` - получить типы доступа
- `hasAccessToCourse(course, options)` - проверить доступ
- `checkAccessCondition(course, accessType, options)` - проверить конкретное условие
- `hasSubscriptionAccess(courseId, userTier)` - проверить доступ по подписке
- `hasDelayedAccess(course, membership)` - проверить отложенный доступ
- `hasGiftedAccess(course, userEmail)` - проверить подарочный доступ

#### 4. Добавить загрузку данных в useEffect
При загрузке курса также загружать:
- Профиль пользователя (`profiles`)
- Членство пользователя в сообществе (`memberships` с `subscription_tiers`)
- Все активные тарифы сообщества (`subscription_tiers`)

#### 5. Выполнить проверку доступа после загрузки данных
После получения всех данных вызвать `hasAccessToCourse()` и установить `hasAccess`

#### 6. Добавить UI для заблокированного доступа
Если `hasAccess === false`:
- Показать сообщение "Доступ к курсу ограничен"
- Показать информацию о способах получения доступа
- Добавить кнопку "Оплатить" (если `paid_subscription`)
- Добавить форму ввода промокода (если `promo_code`)
- Показать кнопку "Назад к курсам"

#### 7. Сохранить исключения для авторов
Авторы курса (`user.id === course.author_id`) всегда имеют полный доступ

### Структура файлов

```
src/
├── lib/
│   └── courseAccess.ts         # Новый - утилиты проверки доступа
└── pages/
    └── CoursePreview.tsx       # Изменить - добавить проверку
```

### Дополнительно
- Добавить состояние для промокода и диалог ввода промокода
- При успешном вводе промокода разблокировать доступ
- Логика сохранения "разблокированных" курсов временно в state (или можно сохранять в localStorage/БД)

Сохранять промокоды в БД
Страница 'Мои курсы' для студента